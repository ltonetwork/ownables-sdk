(()=>{"use strict";var e={334:(e,t,r)=>{const n=r(969);t.A=class{constructor(e){this.methods=e}send(e,t){Promise.resolve(t).then(t=>this.sendResult(e,t)).catch(t=>this.sendError(e,t))}sendResult(e,t){const{channel:r,id:s}=e.data,a=e.source||this.fallbackSource,o=e.origin&&"null"!==e.origin?e.origin:"*";a.postMessage({"@rpc":n.RESPONSE_TYPE,channel:r,id:s,result:t},o)}sendError(e,t){t instanceof ErrorEvent&&(t=this.convertErrorEvent(t));const{channel:r,id:s}=e.data,a=e.source||this.fallbackSource,o=e.origin&&"null"!==e.origin?e.origin:"*";try{a.postMessage({"@rpc":n.RESPONSE_TYPE,channel:r,id:s,error:t},o)}catch(e){throw console.error(t),e}}convertErrorEvent(e){const t=new Error(e.message);return t.name=e.error&&e.error.name,t.stack=e.error&&e.error.stack,t}listen(e,t){e.addEventListener("message",e=>{if("*"!==t&&e.origin!==t||e.data["@rpc"]!==n.CALL_TYPE)return;const{fn:r,args:s}=e.data;if(r in this.methods)try{this.send(e,this.methods[r](...s))}catch(t){this.sendError(e,t)}else this.sendError(e,`RPC method '${r}' is not defined`)})}}},969:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RESPONSE_TYPE=t.CALL_TYPE=void 0,t.CALL_TYPE="simple-iframe-rpc-call",t.RESPONSE_TYPE="simple-iframe-rpc-response"}},t={};function r(n){var s=t[n];if(void 0!==s)return s.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};let s,a;function o(e){return Object.fromEntries(e.map(e=>[e.key,e.value]))}function i(e,t,r,n,s){return new Promise((o,i)=>{a?(a.addEventListener("message",t=>{if("err"in t.data)return void i(new Error(`Ownable ${e} failed`,{cause:t.data.err}));const r=t.data.get("result"),n=JSON.parse(r),a=t.data.has("mem")?JSON.parse(t.data.get("mem")).state_dump:s;o({response:n,state:a})},{once:!0}),a.postMessage({type:e,ownable_id:t,msg:r,info:n,mem:{state_dump:s}})):i(`Unable to ${e}: not initialized`)})}function c(e,t){return{attributes:o(e.attributes),events:(e.events||[]).map(e=>({type:e.type,attributes:o(e.attributes)})),data:e.data,state:t}}async function d(e,t){return(await i("query",s,e,{},t)).response}async function u(e,t){const r=await d(e,t);try{return JSON.parse(atob(r))}catch(e){throw console.error("Failed to decode base64 result:",e),console.error("Raw result:",r),new Error(`Invalid base64 data: ${e instanceof Error?e.message:"Unknown error"}`)}}r.r(n),new(r(334).A)({init:function(e,t,r){return s=e,new Promise(async(e,n)=>{const s=new Blob([t],{type:"application/javascript"}),o=URL.createObjectURL(s);a=new Worker(o,{type:"module"}),a.onmessage=t=>{e(t.data)},a.onerror=e=>n(e),a.onmessageerror=e=>n(e);const i=r.buffer;a.postMessage(i,[i])})},instantiate:async function(e,t){const{response:r,state:n}=await i("instantiate",s,e,t);return{attributes:o(r.attributes),state:n}},execute:async function(e,t,r){const{response:n,state:a}=await i("execute",s,e,t,r);return c(n,a)},externalEvent:async function(e,t,r){const n={info:t},{response:a,state:o}=await i("external_event",s,e,n,r);return c(a,o)},query:u,queryRaw:d,refresh:async function(e){const t=await u({get_widget_state:{}},e);document.getElementsByTagName("iframe")[0].contentWindow.postMessage({ownable_id:s,state:t},"*")}}).listen(window,"*"),window.addEventListener("message",e=>{"null"!==e.origin||"@rpc"in e.data||window.parent.postMessage(e.data,"*")});var l=self;for(var p in n)l[p]=n[p];n.__esModule&&Object.defineProperty(l,"__esModule",{value:!0})})();
//# sourceMappingURL=ownable.js.map