{"version":3,"file":"ownable.js","mappings":"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","sources":["webpack://@ltonetwork/ownable-sdk/./node_modules/simple-iframe-rpc/lib/constants.js","webpack://@ltonetwork/ownable-sdk/./node_modules/simple-iframe-rpc/lib/listener.js","webpack://@ltonetwork/ownable-sdk/webpack/bootstrap","webpack://@ltonetwork/ownable-sdk/webpack/runtime/make namespace object","webpack://@ltonetwork/ownable-sdk/./src/ownable.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RESPONSE_TYPE = exports.CALL_TYPE = void 0;\nexports.CALL_TYPE = 'simple-iframe-rpc-call';\nexports.RESPONSE_TYPE = 'simple-iframe-rpc-response';\n//# sourceMappingURL=constants.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst constants_1 = require(\"./constants\");\nclass Listener {\n    constructor(methods) {\n        this.methods = methods;\n    }\n    send(event, resultOrPromise) {\n        Promise.resolve(resultOrPromise)\n            .then(result => this.sendResult(event, result))\n            .catch(error => this.sendError(event, error));\n    }\n    sendResult(event, result) {\n        const { channel, id } = event.data;\n        const source = event.source || this.fallbackSource;\n        const targetOrigin = event.origin && event.origin !== \"null\" ? event.origin : \"*\";\n        source.postMessage({ '@rpc': constants_1.RESPONSE_TYPE, channel, id, result }, targetOrigin);\n    }\n    sendError(event, error) {\n        const { channel, id } = event.data;\n        const source = event.source || this.fallbackSource;\n        const targetOrigin = event.origin && event.origin !== \"null\" ? event.origin : \"*\";\n        source.postMessage({ '@rpc': constants_1.RESPONSE_TYPE, channel, id, error }, targetOrigin);\n    }\n    listen(window, targetOrigin) {\n        window.addEventListener(\"message\", (event) => {\n            if ((targetOrigin !== \"*\" && event.origin !== targetOrigin) ||\n                event.data['@rpc'] !== constants_1.CALL_TYPE)\n                return;\n            const { fn, args } = event.data;\n            if (!(fn in this.methods)) {\n                this.sendError(event, `RPC method '${fn}' is not defined`);\n                return;\n            }\n            try {\n                this.send(event, this.methods[fn](...args));\n            }\n            catch (error) {\n                this.sendError(event, error);\n            }\n        });\n    }\n}\nexports.default = Listener;\n//# sourceMappingURL=listener.js.map","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = function(exports) {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// This code runs inside the Ownable iframe. It's not part of the React app.\n// See `ownable-js.webpack.js`\n\n// @ts-ignore\nimport Listener from \"simple-iframe-rpc/listener\";\n\ntype Dict = {[prop: string]: any};\ntype StateDump = Array<[ArrayLike<number>, ArrayLike<number>]>;\ntype CosmWasmEvent = {type: string, attributes: Dict};\n\ninterface MessageInfo {\n  sender: string;\n  funds: ArrayLike<any>;\n}\n\ninterface Response {\n  attributes: Array<{key: string, value: any}>;\n  events?: Array<{type: string, attributes: Array<{key: string, value: any}>}>;\n  data?: string;\n}\n\nconst listener = new Listener({\n  init,\n  instantiate,\n  execute,\n  externalEvent,\n  query,\n  queryRaw,\n  refresh,\n});\nlistener.listen(window, \"*\");\n\nlet ownableId: string;\nlet worker: Worker;\n\nwindow.addEventListener(\"message\", (e) => {\n  if (e.origin !== \"null\" || '@rpc' in e.data) return;\n  window.parent.postMessage(e.data, \"*\");\n});\n\nfunction attributesToDict(attributes: Array<{key: string, value: any}>): Dict {\n  return Object.fromEntries(attributes.map(a => [a.key, a.value]));\n}\n\nfunction init(id: string, javascript: string, wasm: Uint8Array): Promise<any> {\n  ownableId = id;\n\n  return new Promise(async (resolve, reject) => {\n    const blob = new Blob([javascript], {type: `application/javascript`});\n    const blobURL = URL.createObjectURL(blob);\n    worker = new Worker(blobURL, { type: \"module\" });\n\n    worker.onmessage = (event) => {\n      resolve(event.data);\n    };\n    worker.onerror = (err) => reject(err);\n    worker.onmessageerror = (err) => reject(err);\n\n    const buffer = wasm.buffer;\n    worker.postMessage(buffer, [buffer]);\n  });\n}\n\nfunction workerCall<T extends Response|string>(\n  type: string,\n  ownableId: string,\n  msg: Dict,\n  info: Dict,\n  state?: StateDump,\n): Promise<{response: T, state: StateDump}> {\n  return new Promise((resolve, reject) => {\n    if (!worker) {\n      reject(`Unable to ${type}: not initialized`);\n      return;\n    }\n\n    worker.addEventListener('message', (event: MessageEvent<Map<string, any>|{err: any}>) => {\n      if ('err' in event.data) {\n        reject(new Error(`Ownable ${type} failed`, { cause: event.data.err }));\n        return;\n      }\n\n      const result = event.data.get('result');\n      const response = JSON.parse(result);\n      const nextState: StateDump = event.data.has('mem') ? JSON.parse(event.data.get('mem')).state_dump : state;\n\n      resolve({response, state: nextState});\n    }, { once: true });\n    worker.postMessage({type, ownable_id: ownableId, msg, info, mem: {state_dump: state}});\n  });\n}\n\nasync function instantiate(msg: Dict, info: Dict): Promise<{attributes: Dict, state: StateDump}> {\n  const {response, state} = await workerCall<Response>(\n    \"instantiate\",\n    ownableId,\n    msg,\n    info\n  );\n\n  return {attributes: attributesToDict(response.attributes), state};\n}\n\nasync function execute(\n  msg: Dict,\n  info: MessageInfo,\n  state: StateDump\n): Promise<{attributes: Dict, events: Array<CosmWasmEvent>, data?: string, state: StateDump}> {\n  const {response, state: newState} = await workerCall<Response>(\"execute\", ownableId, msg, info, state);\n  return executeResponse(response, newState);\n}\n\nasync function externalEvent(\n  msg: Dict,\n  messageInfo: MessageInfo,\n  state: StateDump\n): Promise<{attributes: Dict, events: Array<CosmWasmEvent>, data?: string, state: StateDump}> {\n  const info = {\n    info: messageInfo,\n  };\n  console.log(\"external event call with \", msg, info);\n\n  const {response, state: newState} = await workerCall<Response>(\"external_event\", ownableId, msg, info, state);\n  return executeResponse(response, newState);\n}\n\nfunction executeResponse(\n  response: Response,\n  state: StateDump\n): {attributes: Dict, events: Array<CosmWasmEvent>, data?: string, state: StateDump} {\n  return {\n    attributes: attributesToDict(response.attributes),\n    events: (response.events || []).map(\n      event => ({type: event.type, attributes: attributesToDict(event.attributes)})\n    ),\n    data: response.data,\n    state,\n  };\n}\n\nasync function queryRaw(msg: Dict, state: StateDump): Promise<string> {\n  return (await workerCall<string>(\"query\", ownableId, msg, {}, state)).response;\n}\n\nasync function query(msg: Dict, state: StateDump): Promise<any> {\n  const resultB64 = await queryRaw(msg, state);\n  return JSON.parse(atob(resultB64)) as Dict;\n}\n\nasync function refresh(state: StateDump): Promise<void> {\n  const widgetState: Dict = await query({get_widget_state: {}}, state);\n\n  const iframe = document.getElementsByTagName('iframe')[0];\n  iframe.contentWindow!.postMessage({ownable_id: ownableId, state: widgetState}, \"*\");\n}\n"],"names":["Object","defineProperty","exports","value","RESPONSE_TYPE","CALL_TYPE","constants_1","constructor","methods","this","send","event","resultOrPromise","Promise","resolve","then","result","sendResult","catch","error","sendError","channel","id","data","source","fallbackSource","targetOrigin","origin","postMessage","listen","window","addEventListener","fn","args","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__","r","Symbol","toStringTag","ownableId","worker","attributesToDict","attributes","fromEntries","map","a","key","workerCall","type","msg","info","state","reject","Error","cause","err","get","response","JSON","parse","nextState","has","state_dump","once","ownable_id","mem","executeResponse","events","async","queryRaw","query","resultB64","atob","Listener","init","javascript","wasm","blob","Blob","blobURL","URL","createObjectURL","Worker","onmessage","onerror","onmessageerror","buffer","instantiate","execute","newState","externalEvent","messageInfo","console","log","refresh","widgetState","get_widget_state","document","getElementsByTagName","contentWindow","e","parent"],"sourceRoot":""}