{"version":3,"file":"ownable.js","mappings":"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","sources":["webpack://@ltonetwork/ownable-sdk/./node_modules/simple-iframe-rpc/lib/listener.js","webpack://@ltonetwork/ownable-sdk/./node_modules/simple-iframe-rpc/lib/constants.js","webpack://@ltonetwork/ownable-sdk/webpack/bootstrap","webpack://@ltonetwork/ownable-sdk/webpack/runtime/make namespace object","webpack://@ltonetwork/ownable-sdk/./src/ownable.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst constants_1 = require(\"./constants\");\nclass Listener {\n    constructor(methods) {\n        this.methods = methods;\n    }\n    send(event, resultOrPromise) {\n        Promise.resolve(resultOrPromise)\n            .then(result => this.sendResult(event, result))\n            .catch(error => this.sendError(event, error));\n    }\n    sendResult(event, result) {\n        const { channel, id } = event.data;\n        const source = event.source || this.fallbackSource;\n        const targetOrigin = event.origin && event.origin !== \"null\" ? event.origin : \"*\";\n        source.postMessage({ '@rpc': constants_1.RESPONSE_TYPE, channel, id, result }, targetOrigin);\n    }\n    sendError(event, error) {\n        if (error instanceof ErrorEvent)\n            error = this.convertErrorEvent(error);\n        const { channel, id } = event.data;\n        const source = event.source || this.fallbackSource;\n        const targetOrigin = event.origin && event.origin !== \"null\" ? event.origin : \"*\";\n        try {\n            source.postMessage({ '@rpc': constants_1.RESPONSE_TYPE, channel, id, error }, targetOrigin);\n        }\n        catch (e) {\n            console.error(error);\n            throw e;\n        }\n    }\n    convertErrorEvent(errorEvent) {\n        const error = new Error(errorEvent.message);\n        error.name = errorEvent.error && errorEvent.error.name;\n        error.stack = errorEvent.error && errorEvent.error.stack;\n        return error;\n    }\n    listen(window, targetOrigin) {\n        window.addEventListener(\"message\", (event) => {\n            if ((targetOrigin !== \"*\" && event.origin !== targetOrigin) ||\n                event.data['@rpc'] !== constants_1.CALL_TYPE)\n                return;\n            const { fn, args } = event.data;\n            if (!(fn in this.methods)) {\n                this.sendError(event, `RPC method '${fn}' is not defined`);\n                return;\n            }\n            try {\n                this.send(event, this.methods[fn](...args));\n            }\n            catch (error) {\n                this.sendError(event, error);\n            }\n        });\n    }\n}\nexports.default = Listener;\n//# sourceMappingURL=listener.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.RESPONSE_TYPE = exports.CALL_TYPE = void 0;\nexports.CALL_TYPE = 'simple-iframe-rpc-call';\nexports.RESPONSE_TYPE = 'simple-iframe-rpc-response';\n//# sourceMappingURL=constants.js.map","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// This code runs inside the Ownable iframe. It's not part of the React app.\n// See `ownable-js.webpack.js`\n\n// @ts-ignore\nimport Listener from \"simple-iframe-rpc/listener\";\n\ntype Dict = { [prop: string]: any };\ntype StateDump = Array<[ArrayLike<number>, ArrayLike<number>]>;\ntype CosmWasmEvent = { type: string; attributes: Dict };\n\ninterface MessageInfo {\n  sender: string;\n  funds: ArrayLike<any>;\n}\n\ninterface Response {\n  attributes: Array<{ key: string; value: any }>;\n  events?: Array<{\n    type: string;\n    attributes: Array<{ key: string; value: any }>;\n  }>;\n  data?: string;\n}\n\nconst listener = new Listener({\n  init,\n  instantiate,\n  execute,\n  externalEvent,\n  query,\n  queryRaw,\n  refresh,\n});\nlistener.listen(window, \"*\");\n\nlet ownableId: string;\nlet worker: Worker;\n\nwindow.addEventListener(\"message\", (e) => {\n  if (e.origin !== \"null\" || \"@rpc\" in e.data) return;\n  window.parent.postMessage(e.data, \"*\");\n});\n\nfunction attributesToDict(\n  attributes: Array<{ key: string; value: any }>\n): Dict {\n  return Object.fromEntries(attributes.map((a) => [a.key, a.value]));\n}\n\nfunction init(id: string, javascript: string, wasm: Uint8Array): Promise<any> {\n  ownableId = id;\n\n  return new Promise(async (resolve, reject) => {\n    const blob = new Blob([javascript], { type: `application/javascript` });\n    const blobURL = URL.createObjectURL(blob);\n    worker = new Worker(blobURL, { type: \"module\" });\n\n    worker.onmessage = (event) => {\n      resolve(event.data);\n    };\n    worker.onerror = (err) => reject(err);\n    worker.onmessageerror = (err) => reject(err);\n\n    const buffer = wasm.buffer;\n    worker.postMessage(buffer, [buffer]);\n  });\n}\n\nfunction workerCall<T extends Response | string>(\n  type: string,\n  ownableId: string,\n  msg: Dict,\n  info: Dict,\n  state?: StateDump\n): Promise<{ response: T; state: StateDump }> {\n  return new Promise((resolve, reject) => {\n    if (!worker) {\n      reject(`Unable to ${type}: not initialized`);\n      return;\n    }\n\n    worker.addEventListener(\n      \"message\",\n      (event: MessageEvent<Map<string, any> | { err: any }>) => {\n        if (\"err\" in event.data) {\n          reject(\n            new Error(`Ownable ${type} failed`, { cause: event.data.err })\n          );\n          return;\n        }\n\n        const result = event.data.get(\"result\");\n        const response = JSON.parse(result);\n        const nextState: StateDump = event.data.has(\"mem\")\n          ? JSON.parse(event.data.get(\"mem\")).state_dump\n          : state;\n\n        resolve({ response, state: nextState });\n      },\n      { once: true }\n    );\n    worker.postMessage({\n      type,\n      ownable_id: ownableId,\n      msg,\n      info,\n      mem: { state_dump: state },\n    });\n  });\n}\n\nasync function instantiate(\n  msg: Dict,\n  info: Dict\n): Promise<{ attributes: Dict; state: StateDump }> {\n  const { response, state } = await workerCall<Response>(\n    \"instantiate\",\n    ownableId,\n    msg,\n    info\n  );\n\n  return { attributes: attributesToDict(response.attributes), state };\n}\n\nasync function execute(\n  msg: Dict,\n  info: MessageInfo,\n  state: StateDump\n): Promise<{\n  attributes: Dict;\n  events: Array<CosmWasmEvent>;\n  data?: string;\n  state: StateDump;\n}> {\n  const { response, state: newState } = await workerCall<Response>(\n    \"execute\",\n    ownableId,\n    msg,\n    info,\n    state\n  );\n  return executeResponse(response, newState);\n}\n\nasync function externalEvent(\n  msg: Dict,\n  messageInfo: MessageInfo,\n  state: StateDump\n): Promise<{\n  attributes: Dict;\n  events: Array<CosmWasmEvent>;\n  data?: string;\n  state: StateDump;\n}> {\n  const info = {\n    info: messageInfo,\n  };\n\n  const { response, state: newState } = await workerCall<Response>(\n    \"external_event\",\n    ownableId,\n    msg,\n    info,\n    state\n  );\n  return executeResponse(response, newState);\n}\n\nfunction executeResponse(\n  response: Response,\n  state: StateDump\n): {\n  attributes: Dict;\n  events: Array<CosmWasmEvent>;\n  data?: string;\n  state: StateDump;\n} {\n  return {\n    attributes: attributesToDict(response.attributes),\n    events: (response.events || []).map((event) => ({\n      type: event.type,\n      attributes: attributesToDict(event.attributes),\n    })),\n    data: response.data,\n    state,\n  };\n}\n\nasync function queryRaw(msg: Dict, state: StateDump): Promise<string> {\n  return (await workerCall<string>(\"query\", ownableId, msg, {}, state))\n    .response;\n}\n\nasync function query(msg: Dict, state: StateDump): Promise<any> {\n  const resultB64 = await queryRaw(msg, state);\n  return JSON.parse(atob(resultB64)) as Dict;\n}\n\nasync function refresh(state: StateDump): Promise<void> {\n  const widgetState: Dict = await query({ get_widget_state: {} }, state);\n\n  const iframe = document.getElementsByTagName(\"iframe\")[0];\n  iframe.contentWindow!.postMessage(\n    { ownable_id: ownableId, state: widgetState },\n    \"*\"\n  );\n}\n"],"names":["constants_1","exports","constructor","methods","this","send","event","resultOrPromise","Promise","resolve","then","result","sendResult","catch","error","sendError","channel","id","data","source","fallbackSource","targetOrigin","origin","postMessage","RESPONSE_TYPE","ErrorEvent","convertErrorEvent","e","console","errorEvent","Error","message","name","stack","listen","window","addEventListener","CALL_TYPE","fn","args","Object","defineProperty","value","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__","r","Symbol","toStringTag","ownableId","worker","attributesToDict","attributes","fromEntries","map","a","key","workerCall","type","msg","info","state","reject","cause","err","get","response","JSON","parse","nextState","has","state_dump","once","ownable_id","mem","executeResponse","events","async","queryRaw","query","resultB64","atob","Listener","init","javascript","wasm","blob","Blob","blobURL","URL","createObjectURL","Worker","onmessage","onerror","onmessageerror","buffer","instantiate","execute","newState","externalEvent","messageInfo","refresh","widgetState","get_widget_state","document","getElementsByTagName","contentWindow","parent"],"sourceRoot":""}